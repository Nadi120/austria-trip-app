<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>××•×¡×˜×¨×™×” & ×‘×•×•×¨×™×” 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#1f5233" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{margin:0;font-family:Arial;background:#f4f6fb;}
    header{background:#0d47a1;color:#fff;padding:10px;text-align:center;}
    #controls button{margin:3px;padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
    #layout{display:flex;flex-wrap:wrap;}
    #map{height:78vh;flex:3;min-width:300px;}
    #info{flex:1;background:#fff;padding:10px;min-width:240px;border-left:1px solid #ddd;}
    .badge{background:#e3f2fd;padding:4px 6px;border-radius:6px;margin:2px 0;display:inline-block;}
    #notes{width:100%;height:110px;margin-top:6px;}
    #weather{margin-top:6px;font-size:14px;color:#0d47a1;}
  </style>
</head>

<body>

<header>
<h1>ğŸ”¥ ××ª×›× ×Ÿ ×”×˜×™×•×œ ULTRA+</h1>
<div id="controls">
<div id="dayButtons"></div>
<button id="showAll">××¡×œ×•×œ ××œ×</button>
<button id="locateMe">ğŸ“ ×”××™×§×•× ×©×œ×™</button>
<button id="toggleBike">ğŸš´ ××¡×œ×•×œ×™ ××•×¤× ×™×™×</button>
</div>
</header>

<div id="layout">
<div id="map"></div>
<div id="info">
<h2 id="dayTitle">×‘×—×¨ ×™×•×</h2>
<div id="details"></div>
<div id="weather"></div>
<hr>
<textarea id="notes" placeholder="×”×¢×¨×•×ª ××™×©×™×•×ª..."></textarea>
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ================= MAP =================
var map=L.map('map').setView([47.5,12.5],7);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
 attribution:'Â© OpenStreetMap'
}).addTo(map);

// bike layer
var bikeLayer=L.tileLayer(
 'https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=demo'
);

// icons
var hotelIcon=L.icon({
 iconUrl:'https://cdn-icons-png.flaticon.com/512/139/139899.png',
 iconSize:[28,28]
});

var poiIcon=L.icon({
 iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684908.png',
 iconSize:[26,26]
});

var meIcon=L.icon({
 iconUrl:'https://cdn-icons-png.flaticon.com/512/64/64113.png',
 iconSize:[26,26]
});

// ================= DATA =================
var days=[
{
 title:"×™×•× 1: ××™× ×›×Ÿ â†’ ×–×œ×¦×‘×•×¨×’",
 travel:"1:45",
 start:{name:"××™× ×›×Ÿ",coords:[48.1351,11.5820]},
 end:{name:"×–×œ×¦×‘×•×¨×’ (×œ×™× ×”)",coords:[47.8095,13.0550]},
 attractions:[]
},
{
 title:"×™×•× 2: ×–×œ×¦×‘×•×¨×’ â†’ ×¤×œ×›××•",
 travel:"1:00",
 start:{name:"×–×œ×¦×‘×•×¨×’",coords:[47.8095,13.0550]},
 end:{name:"×¤×œ×›××• (×œ×™× ×”)",coords:[47.3443,13.3916]},
 attractions:[
   {name:"Lucky Flitzer",coords:[47.3448,13.3928]}
 ]
}
];

var layers=[];
function clearMap(){layers.forEach(l=>map.removeLayer(l));layers=[];}
function navLink(c){return `https://waze.com/ul?ll=${c[0]},${c[1]}&navigate=yes`;}

// weather
async function loadWeather(lat,lon){
 try{
  let r=await fetch(
   `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`
  );
  let j=await r.json();
  if(j.current_weather){
   document.getElementById("weather").innerHTML=
     `ğŸŒ¦ï¸ ××–×’ ××•×•×™×¨: ${j.current_weather.temperature}Â°C ×¨×•×— ${j.current_weather.windspeed}`;
  }
 }catch(e){}
}

// show day
function showDay(i){
 clearMap();
 var d=days[i];

 document.getElementById("dayTitle").innerText=d.title;

 var html=`<span class="badge">â± ${d.travel}</span><br>
 <b>×”×ª×—×œ×”:</b> ${d.start.name}<br>
 <b>×¡×™×•×:</b> ${d.end.name}<br><br><b>××˜×¨×§×¦×™×•×ª:</b><br>`;

 d.attractions.forEach(a=>html+="â€¢ "+a.name+"<br>");
 document.getElementById("details").innerHTML=html;

 loadWeather(d.end.coords[0],d.end.coords[1]);

 var pts=[d.start,...d.attractions,d.end];

 pts.forEach((p,idx)=>{
   var icon=(idx===0||idx===pts.length-1)?hotelIcon:poiIcon;
   var m=L.marker(p.coords,{icon}).addTo(map)
     .bindPopup(`<b>${p.name}</b><br><a target="_blank" href="${navLink(p.coords)}">× ×•×•×˜ ×‘-Waze</a>`);
   layers.push(m);
 });

 var line=L.polyline(pts.map(p=>p.coords),{color:'red',weight:4}).addTo(map);
 layers.push(line);
 map.fitBounds(line.getBounds(),{padding:[30,30]});
}

// full route
document.getElementById("showAll").onclick=function(){
 clearMap();
 var all=[];
 days.forEach(d=>all.push(d.start,...d.attractions,d.end));
 var line=L.polyline(all.map(p=>p.coords),{color:'purple',weight:4}).addTo(map);
 layers.push(line);
 map.fitBounds(line.getBounds(),{padding:[30,30]});
};

// GPS
document.getElementById("locateMe").onclick=function(){
 if(!navigator.geolocation) return alert("××™×Ÿ GPS");
 navigator.geolocation.getCurrentPosition(pos=>{
   var c=[pos.coords.latitude,pos.coords.longitude];
   var m=L.marker(c,{icon:meIcon}).addTo(map).bindPopup("×”××™×§×•× ×©×œ×™").openPopup();
   layers.push(m);
   map.setView(c,10);
 });
};

// bike toggle
var bikeOn=false;
document.getElementById("toggleBike").onclick=function(){
 bikeOn=!bikeOn;
 if(bikeOn) bikeLayer.addTo(map);
 else map.removeLayer(bikeLayer);
};

// notes save
var notes=document.getElementById("notes");
notes.value=localStorage.getItem("tripNotes")||"";
notes.oninput=()=>localStorage.setItem("tripNotes",notes.value);

// buttons
var btnDiv=document.getElementById("dayButtons");
days.forEach((d,i)=>{
 var b=document.createElement("button");
 b.innerText="×™×•× "+(i+1);
 b.onclick=()=>showDay(i);
 btnDiv.appendChild(b);
});

// ================= SERVICE WORKER REGISTRATION =================
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('SW registered'))
      .catch(err => console.log('SW failed', err));
  });
}
</script>

</body>
</html>
